self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.RecipientPermissionChecker.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[382],{1028:function(e,t,n){var r=n(1264),i=36e5,a=6e4,s=2,c=/[T ]/,o=/:/,u=/^(\d{2})$/,d=[/^([+-]\d{2})$/,/^([+-]\d{3})$/,/^([+-]\d{4})$/],f=/^(\d{4})/,l=[/^([+-]\d{4})/,/^([+-]\d{5})/,/^([+-]\d{6})/],p=/^-(\d{2})$/,h=/^-?(\d{3})$/,m=/^-?(\d{2})-?(\d{2})$/,v=/^-?W(\d{2})$/,_=/^-?W(\d{2})-?(\d{1})$/,b=/^(\d{2}([.,]\d*)?)$/,g=/^(\d{2}):?(\d{2}([.,]\d*)?)$/,w=/^(\d{2}):?(\d{2}):?(\d{2}([.,]\d*)?)$/,y=/([Z+-].*)$/,I=/^(Z)$/,O=/^([+-])(\d{2})$/,P=/^([+-])(\d{2}):?(\d{2})$/;function S(e,t,n){t=t||0,n=n||0;var r=new Date(0);r.setUTCFullYear(e,0,4);var i=7*t+n+1-(r.getUTCDay()||7);return r.setUTCDate(r.getUTCDate()+i),r}e.exports=function(e,t){if(r(e))return new Date(e.getTime());if("string"!=typeof e)return new Date(e);var n=(t||{}).additionalDigits;n=null==n?s:Number(n);var j=function(e){var t,n={},r=e.split(c);if(o.test(r[0])?(n.date=null,t=r[0]):(n.date=r[0],t=r[1]),t){var i=y.exec(t);i?(n.time=t.replace(i[1],""),n.timezone=i[1]):n.time=t}return n}(e),x=function(e,t){var n,r=d[t],i=l[t];if(n=f.exec(e)||i.exec(e)){var a=n[1];return{year:parseInt(a,10),restDateString:e.slice(a.length)}}if(n=u.exec(e)||r.exec(e)){var s=n[1];return{year:100*parseInt(s,10),restDateString:e.slice(s.length)}}return{year:null}}(j.date,n),D=x.year,k=function(e,t){if(null===t)return null;var n,r,i,a;if(0===e.length)return(r=new Date(0)).setUTCFullYear(t),r;if(n=p.exec(e))return r=new Date(0),i=parseInt(n[1],10)-1,r.setUTCFullYear(t,i),r;if(n=h.exec(e)){r=new Date(0);var s=parseInt(n[1],10);return r.setUTCFullYear(t,0,s),r}if(n=m.exec(e)){r=new Date(0),i=parseInt(n[1],10)-1;var c=parseInt(n[2],10);return r.setUTCFullYear(t,i,c),r}if(n=v.exec(e))return a=parseInt(n[1],10)-1,S(t,a);if(n=_.exec(e)){a=parseInt(n[1],10)-1;var o=parseInt(n[2],10)-1;return S(t,a,o)}return null}(x.restDateString,D);if(k){var T,A=k.getTime(),E=0;return j.time&&(E=function(e){var t,n,r;if(t=b.exec(e))return(n=parseFloat(t[1].replace(",",".")))%24*i;if(t=g.exec(e))return n=parseInt(t[1],10),r=parseFloat(t[2].replace(",",".")),n%24*i+r*a;if(t=w.exec(e)){n=parseInt(t[1],10),r=parseInt(t[2],10);var s=parseFloat(t[3].replace(",","."));return n%24*i+r*a+1e3*s}return null}(j.time)),j.timezone?(R=j.timezone,T=(N=I.exec(R))?0:(N=O.exec(R))?(F=60*parseInt(N[2],10),"+"===N[1]?-F:F):(N=P.exec(R))?(F=60*parseInt(N[2],10)+parseInt(N[3],10),"+"===N[1]?-F:F):0):(T=new Date(A+E).getTimezoneOffset(),T=new Date(A+E+T*a).getTimezoneOffset()),new Date(A+E+T*a)}var R,N,F;return new Date(e)}},1264:function(e,t){e.exports=function(e){return e instanceof Date}},1404:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=function(e){return r.__assign({__type:"FindItemRequest:#Exchange"},e)}},1405:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(56),i=n(1855);t.default=function(e,t){return void 0===e||e.__type||(e=i.default(e)),r.makeServiceRequest("FindItem",e,t)}},1855:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=function(e){return r.__assign({__type:"FindItemJsonRequest:#Exchange"},e)}},2243:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=function(e){return r.__assign({__type:"GetAccessTokenForDataProviderRequest:#Exchange"},e)}},2249:function(e,t,n){var r=n(2946),i=6e4;e.exports=function(e,t){var n=Number(t);return r(e,n*i)}},2441:function(e,t,n){"use strict";var r;n.d(t,"a",function(){return r}),function(e){e[e.None=0]="None",e[e.InProgress=1]="InProgress",e[e.Failed=2]="Failed",e[e.SucceededWithDLOrGroupMembers=3]="SucceededWithDLOrGroupMembers",e[e.SucceededWithoutDLOrGroupMembers=4]="SucceededWithoutDLOrGroupMembers"}(r||(r={}))},2461:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(56),i=n(2243);t.default=function(e,t){return void 0===e||e.__type||(e=i.default(e)),r.makeServiceRequest("GetAccessTokenforDataProvider",e,t)}},2946:function(e,t,n){var r=n(1028);e.exports=function(e,t){var n=r(e).getTime(),i=Number(t);return new Date(n+i)}},3623:function(e,t,n){"use strict";var r;n.d(t,"a",function(){return r}),function(e){e[e.None=0]="None",e[e.To=1]="To",e[e.Cc=2]="Cc",e[e.Bcc=3]="Bcc"}(r||(r={}))},3933:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=function(e){return r.__assign({__type:"FetchDataProviderResourceRequest:#Exchange"},e)}},4255:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(56),i=n(3933);t.default=function(e,t){return void 0===e||e.__type||(e=i.default(e)),r.makeServiceRequest("FetchDataProviderResource",e,t)}},4474:function(e,t,n){"use strict";var r=n(3),i=n(2),a=Object(i.action)("ONE_RECIPIENT_SELECTED_ACTION",function(e){return{recipientWell:e}});n.d(t,"a",function(){return c}),n.d(t,"b",function(){return o}),n.d(t,"c",function(){return a});var s=new r.c(function(){return Promise.all([n.e(72),n.e(377)]).then(n.bind(null,13595))}),c=new r.a(s,function(e){return e.findReadWriteRecipient}),o=new r.b(s,function(e){return e.getGroupInfo})},4545:function(e,t,n){"use strict";n.d(t,"c",function(){return c}),n.d(t,"d",function(){return o});var r=n(3),i=n(3623);n.d(t,"b",function(){return i.a});var a=n(2441);n.d(t,"a",function(){return a.a});var s=new r.c(function(){return n.e(381).then(n.bind(null,6574))}),c=new r.a(s,function(e){return e.setMembersToRecipientViewState}),o=new r.a(s,function(e){return e.setRecipientExpansionStatus})},494:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=function(e){return r.__assign({__type:"ItemResponseShape:#Exchange"},e)}},542:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=function(e){return r.__assign({__type:"IndexedPageView:#Exchange"},e)}},5518:function(e,t,n){"use strict";n.r(t);var r=n(0),i=n(3747),a=n(4545),s=n(3600);function c(e,t,n){return r.__awaiter(this,void 0,void 0,function(){var c,o,u,d;return r.__generator(this,function(r){switch(r.label){case 0:return[4,s.e.import()];case 1:return c=r.sent(),o=c(t),u=[],o.some(function(e){return e.recipient.expansionStatus===a.a.None})?(Object(i.b)(e,o,n),[2,[!1,u]]):(d=o.filter(function(e){return e.recipient.expansionStatus===a.a.SucceededWithoutDLOrGroupMembers})).length!==o.length?[2,[!1,u]]:(d.forEach(function(e){e.recipient.members.forEach(function(e){u.push(e)})}),[2,[!0,u]])}})})}function o(e,t,n){return r.__awaiter(this,void 0,void 0,function(){var i,a,o,u,d,f;return r.__generator(this,function(l){switch(l.label){case 0:return[4,s.k.import()];case 1:return i=l.sent(),[4,s.m.import()];case 2:return a=l.sent(),i(t)||a(t)?[2,[]]:[4,c(e,t,n)];case 3:return o=r.__read.apply(void 0,[l.sent(),2]),u=o[0],d=o[1],u?[4,s.g.import()]:[2,[]];case 4:return f=l.sent(),f(t).forEach(function(e){d.push({emailAddress:e.recipient.persona.EmailAddress.EmailAddress,displayName:e.recipient.persona.EmailAddress.Name,personaTypeString:null})}),[2,d]}})})}var u=n(3516);function d(e){var t=Object(u.g)(e);return t&&t.sharingInfo.getSharingInfoSucceeded&&(0===t.currentPermissionLevel||2===t.currentPermissionLevel||1===t.currentPermissionLevel)}var f=n(18),l=n(4),p=n(11),h="POST",m="cors",v=n(2436),_=n(3933),b=n.n(_),g=n(4255),w=n.n(g);function y(e,t,n,i){return r.__awaiter(this,void 0,void 0,function(){var a;return r.__generator(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,Object(v.k)(e,!1,n)];case 1:return a=r.sent(),[3,3];case 2:return r.sent(),[3,3];case 3:return a?(Object(f.o)("fetchServiceViaDataProvider"),p.d.info("fetchServiceViaDataProvider"),[4,I(t,a,i)]):[3,5];case 4:return[2,r.sent()];case 5:return Object(f.o)("fetchServiceViaOWAServer"),p.d.info("fetchServiceViaOWAServer"),[4,O(e,t,i)];case 6:return[2,r.sent()]}})})}function I(e,t,n){return r.__awaiter(this,void 0,void 0,function(){var i;return r.__generator(this,function(r){return i=Date.now(),[2,fetch(e,{method:n.method,mode:n.mode,headers:{Authorization:t,"Content-Type":"application/json",Accept:"application/json;odata=verbose"},body:n.body}).then(function(e){if(Object(f.o)(n.datapointNamePrefix+"DataProvider",[Date.now()-i]),200===e.status)return e.json();throw new Error("Response status = "+e.status+", body = "+e.body)}).then(function(e){return JSON.stringify(e)})]})})}function O(e,t,n){return r.__awaiter(this,void 0,void 0,function(){var i,a,s;return r.__generator(this,function(r){switch(r.label){case 0:return i=b()({ProviderType:e,Url:t,Method:n.method,Body:n.body,IsJsonPost:!0}),a=Date.now(),[4,w()(i)];case 1:if(s=r.sent(),Object(f.o)(n.datapointNamePrefix+"OWA",[Date.now()-a]),200===s.Status&&s.Body)return[2,s.Body];throw new Error("Response status = "+s.Status+", body = "+s.Body)}})})}var P=n(171);function S(e,t){return r.__awaiter(this,void 0,void 0,function(){var n,i,a;return r.__generator(this,function(r){switch(r.label){case 0:return n=function(e){return Object(l.b)("https://{0}/{1}/{2}/permission/checkAccess",Object(P.parse)(e).hostname,v.a,function(e){return"u!"+btoa(e).replace(/=+$/,"").replace("/","_").replace("+","-")}(e))}(e),i=function(e){return JSON.stringify((t=e,{recipients:t.map(function(e){return{alias:e.emailAddress}})}));var t}(t),a=null,[4,y(0,n,e,{method:h,mode:m,body:i,datapointNamePrefix:"checkRecipientPermission"})];case 1:return a=r.sent(),[2,JSON.parse(a).value]}})})}var j={};var x=30;function D(e,t,n,i){return r.__awaiter(this,void 0,void 0,function(){var a,s,c,o,h,m;return r.__generator(this,function(v){switch(v.label){case 0:return e.length>0?(p.d.info(Object(l.b)("RecipientPermission: LinkId:{0}, add {1} recipients",t,e.length)),a=null,[4,u.i.import()]):[3,10];case 1:if(s=v.sent(),!d(t))return[2,!1];s(t,e),function(e){j.hasOwnProperty(e)?j[e]=j[e]+1:j[e]=1}(i),v.label=2;case 2:v.trys.push([2,8,9,10]),c=0,v.label=3;case 3:return c<e.length/x?(a=e.slice(c*x,(c+1)*x),d(t)?[4,S(n,a)]:[2,!1]):[3,7];case 4:return o=v.sent(),h=o.some(function(e){return!e.hasAccess}),[4,u.q.import()];case 5:v.sent()(t,o),function(e,t){Object(f.o)("CheckPermissionForRecipients",[e,Math.min(t,23)])}(h,o.length),p.d.info(Object(l.b)("RecipientPermission: checkAccess for {0} recipients succeeded",o.length)),v.label=6;case 6:return c++,[3,3];case 7:return[3,10];case 8:return m=v.sent(),function(e,t,n){r.__awaiter(this,void 0,void 0,function(){return r.__generator(this,function(r){switch(r.label){case 0:return Object(f.o)("CheckRecipientPermissionFailure",[n]),p.d.info(Object(l.b)("RecipientPermission: checkAccess for {0} recipients failed",t.length)),[4,u.o.import()];case 1:return r.sent()(e,t),[2]}})})}(t,null!=a?a:e,m.message),[2,!1];case 9:return function(e){j.hasOwnProperty(e)?j[e]>1?j[e]=j[e]-1:delete j[e]:p.d.error("Finish check perm while tracker has not logged start. ")}(i),[7];case 10:return[2,!0]}})})}function k(e,t,n){return r.__awaiter(this,void 0,void 0,function(){var i,a,c;return r.__generator(this,function(o){switch(o.label){case 0:return(i=Object(u.h)(e))&&d(e)?(a=i.unwrappedUrl?i.unwrappedUrl:i.url,[4,s.j.import()]):[2];case 1:return c=o.sent(),function(e,t,n){r.__awaiter(this,void 0,void 0,function(){var i;return r.__generator(this,function(r){switch(r.label){case 0:return(i=e.filter(function(e){return!T(e.emailAddress,t)})).length>0?(p.d.info(Object(l.b)("RecipientPermission: LinkId:{0}, remove {1} recipients ",n,i.length)),[4,u.m.import()]):[3,2];case 1:r.sent()(n,i),r.label=2;case 2:return[2]}})})}(i.sharingRecipientsInfo.recipientPermissionInfos,t,e),c(i.sharingRecipientsInfo)?[2]:[4,D(function(e,t){var n=t.filter(function(t){return!T(t.emailAddress,e)}),r=[];return n.forEach(function(e){r.push({emailAddress:e.emailAddress,name:e.displayName,getPermissionInfoStatus:s.a.InProgress,hasAccess:!1})}),r}(i.sharingRecipientsInfo.recipientPermissionInfos,t),e,a,n)];case 2:return o.sent(),[2]}})})}function T(e,t){return t.some(function(t){return t.emailAddress===e})}var A=n(6),E=n(2);function R(e){return e.some(function(e){return d(e)})}Object(E.orchestrator)(i.d,function(e){return r.__awaiter(void 0,void 0,void 0,function(){var t,n;return r.__generator(this,function(r){switch(r.label){case 0:return Object(A.e)("doc-attachment-contextualSharingTips")&&R(e.linkIds)?(p.d.info("RecipientPermission: tryCheckPermForLinks"),[4,o(e.linkIds,e.recipientInfos,e.composeId)]):[2];case 1:t=r.sent(),n=0,r.label=2;case 2:return n<e.linkIds.length?[4,k(e.linkIds[n],t,e.composeId)]:[3,5];case 3:r.sent(),r.label=4;case 4:return n++,[3,2];case 5:return[2]}})})});var N=n(4474);function F(e){return r.__awaiter(this,void 0,void 0,function(){var t,n,i,s,c,o,u,d,l,h;return r.__generator(this,function(r){switch(r.label){case 0:return p.d.info("RecipientPermission: expandAndSetRecipientViewState"),[4,N.b.import()];case 1:return t=r.sent(),n=e.recipient.persona,i=e.recipient.persona.EmailAddress,s={EmailAddress:i.EmailAddress,Name:i.Name,MailboxType:i.MailboxType,RoutingType:i.RoutingType},[4,a.d.import()];case 2:c=r.sent(),r.label=3;case 3:return r.trys.push([3,7,,8]),c(e.recipient,a.a.InProgress),[4,t(n.PersonaId,n.ADObjectId,s,100,!0)];case 4:return(o=r.sent())&&o.Members?(u=!1,d=[],o.Members.forEach(function(e){var t;switch(e.PersonaTypeString){case"DistributionList":case"ImplicitGroup":case"ExplicitGroup":case"ModernGroup":u=!0,t={emailAddress:e.EmailAddress.EmailAddress,displayName:e.DisplayName,personaTypeString:e.PersonaTypeString};break;case"Person":case"Guest":t={emailAddress:e.EmailAddress.EmailAddress,displayName:e.DisplayName,personaTypeString:e.PersonaTypeString};break;default:p.d.error("RecipientExpansionIgnoredPersonaType: "+e.PersonaTypeString)}t&&d.push(t)}),[4,a.c.import()]):[3,6];case 5:return l=r.sent(),Object(f.o)("SmallDLExpansionSucceess",[u]),c(e.recipient,u?a.a.SucceededWithDLOrGroupMembers:a.a.SucceededWithoutDLOrGroupMembers),l(e.recipient,d),[2];case 6:return[3,8];case 7:return h=r.sent(),Object(f.o)("SmallDLExpansionFailure",[h.message]),[3,8];case 8:return c(e.recipient,a.a.Failed),[2]}})})}Object(E.orchestrator)(i.b,function(e){return r.__awaiter(void 0,void 0,void 0,function(){var t,n,c,o;return r.__generator(this,function(r){switch(r.label){case 0:return Object(A.e)("doc-attachment-contextualSharingTips")&&R(e.linkIds)?[4,s.e.import()]:[2];case 1:t=r.sent(),n=t(e.recipientInfos),c=n.filter(function(e){return e.recipient.expansionStatus===a.a.None}),o=0,r.label=2;case 2:return o<c.length?[4,F(c[o])]:[3,5];case 3:r.sent(),r.label=4;case 4:return o++,[3,2];case 5:return Object(i.d)(e.linkIds,e.recipientInfos,e.composeId),[2]}})})});Object(E.orchestrator)(i.e,function(e){return r.__awaiter(void 0,void 0,void 0,function(){var t,n,i;return r.__generator(this,function(r){switch(r.label){case 0:return Object(A.e)("doc-attachment-contextualSharingTips")&&d(e.linkId)?(p.d.info("RecipientPermission: tryCheckPermForOneLink"),[4,u.j.import()]):[2];case 1:return t=r.sent(),n=t(e.recipientContainers,e.fromAddress),[4,o([e.linkId],n,e.composeId)];case 2:return 0===(i=r.sent()).length?[2]:[4,k(e.linkId,i,e.composeId)];case 3:return r.sent(),[2]}})})});Object(E.orchestrator)(i.a,function(e){return r.__awaiter(void 0,void 0,void 0,function(){return r.__generator(this,function(t){var n;return n=e.composeId,j.hasOwnProperty(n)&&Object(f.o)("checkPermPendingWhenSend"),[2]})})});Object(E.orchestrator)(i.c,function(e){return r.__awaiter(void 0,void 0,void 0,function(){var t;return r.__generator(this,function(n){switch(n.label){case 0:return Object(A.e)("doc-attachment-contextualSharingTips")?[4,u.n.import()]:[2];case 1:return n.sent()(e.linkId),[4,o([e.linkId],e.recipientInfos,e.composeId)];case 2:return 0===(t=n.sent()).length?[2]:[4,k(e.linkId,t,e.composeId)];case 3:return n.sent(),[2]}})})}),n.d(t,"tryCheckPermForLinks",function(){return i.d}),n.d(t,"tryCheckPermForOneLink",function(){return i.e}),n.d(t,"expandGroupsAndSmallDLs",function(){return i.b}),n.d(t,"onLinkHasChanged",function(){return i.c})}},0,[12,296,514,105,24,116,413]]);
//# sourceMappingURL=owa.RecipientPermissionChecker.js.map
self.scriptsLoaded['owa.RecipientPermissionChecker.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.RecipientPermissionChecker.js'] = (new Date()).getTime();