self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.SharePointLink.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[410],{1324:function(e,t,n){"use strict";var r=n(2);t.a=Object(r.action)("ON_BPOS_NAV_BAR_DATA_LOADED")},1330:function(e,t,n){"use strict";var r=n(847),o=n(2),a=Object(o.action)("SET_BPOS_NAV_BAR_DATA ",function(e){return{bposNavBarData:e}});Object(o.mutator)(a,function(e){r.a.bposNavBarData=e.bposNavBarData});var i=n(1333),c=n.n(i);var u=n(1324),s=n(25),f=Object(o.action)("LOAD_BposNavBarData"),l=f;Object(o.orchestrator)(f,function(e){Object(s.p)()||c()().then(function(e){a(e),Object(u.a)()})});var d=n(22);function p(){return r.a.bposNavBarData}n.d(t,"a",function(){return p}),n.d(t,"b",function(){return a}),Object(d.d)(function(){l()})},1333:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(56);t.default=function(e){return r.makeServiceRequest("GetBposShellInfoNavBarData",{},e)}},3393:function(e,t,n){"use strict";n.r(t);var r=n(2),o=Object(r.action)("tryQueueGetWacInfo",function(e){return{url:e}}),a=Object(r.action)("queueGetWacInfo",function(e){return{url:e}}),i=Object(r.action)("processGetWacInfoQueue"),c=Object(r.action)("getWacInfoQueueShift"),u=Object(r.action)("onStartGetWacInfoOperation",function(e){return{url:e}}),s=Object(r.action)("onFinishGetWacInfoOperation",function(e){return{url:e}}),f=Object(r.action)("pushSupressedUrl",function(e){return{url:e}}),l=Object(r.action)("onGetWacInfoSuccess",function(e,t){return{url:e,wacUrlInfo:t}}),d={activeGetWacInfoOperations:[],getWacInfoQueue:[],suppressedUrls:[],docLinkPreviewInfoMap:new(n(7).ObservableMap)},p=Object(r.createStore)("sharePointDocLinkPreview",d)();Object(r.mutator)(u,function(e){var t=e.url;p.activeGetWacInfoOperations.push(t)}),Object(r.mutator)(s,function(e){var t=e.url;p.activeGetWacInfoOperations.splice(p.activeGetWacInfoOperations.indexOf(t),1)}),Object(r.mutator)(l,function(e){var t=e.url,n=e.wacUrlInfo,r={time:Date.now(),wacUrlInfo:n};p.docLinkPreviewInfoMap.set(t,r)}),Object(r.mutator)(a,function(e){var t=e.url;p.getWacInfoQueue.push(t)}),Object(r.mutator)(c,function(){p.getWacInfoQueue.shift()}),Object(r.mutator)(f,function(e){var t=e.url;p.suppressedUrls.push(t)});var v=n(0),b=108e6;function O(e){return h(e).docLinkPreviewInfo||null}function h(e){var t=p.docLinkPreviewInfoMap.get(e);return t?t.time+b>Date.now()?{docLinkPreviewInfo:t}:{reason:"Expired"}:p.getWacInfoQueue.some(function(t){return t===e})||p.activeGetWacInfoOperations.some(function(t){return t===e})?{reason:"InQueue"}:p.suppressedUrls.some(function(t){return t===e})?{reason:"FileTypeNotSupportedOrSuppressedAfterError"}:{reason:"Unknown"}}var j=n(4325),S=n(4254),m=n(6);function w(e,t){return v.__awaiter(this,void 0,void 0,function(){var n,r,o;return v.__generator(this,function(a){switch(a.label){case 0:return a.trys.push([0,,5,6]),u(e),n=null,Object(m.e)("doc-SxS-jsApi-ODB-Links")?[4,Object(S.a)(0,e,!0)]:[3,2];case 1:return(r=a.sent())?(n={wacUrl:r.openWith.wac.applicationUrl,jsApiInfo:{bootScriptUrl:r.openWith.wac.bootstrapperUrl,wopiSrcUrl:r.openWith.wac.wopiSrc,accessToken:r.openWith.wac.accessToken,fileSize:r.size,fileGetUrl:r.openWith.wac.fileGetUrl,bundleInfo:r.officeBundle,fetchStartTime:r.fetchStartTime,responseStartTime:r.responseStartTime,openUrl:e,fileName:r.name},readOnly:r.currentUserRole.readOnly},[3,4]):(f(e),[2,null]);case 2:return[4,Object(j.a)(e,0)];case 3:if(9===(o=a.sent()).Status||6===o.Status||5===o.Status)return f(e),[2,null];0===o.Status&&(n={wacUrl:o.WacUrl,bootScriptUrl:o.BootScriptUrl,wopiSrcUrl:o.WopiSrcUrl,accessToken:o.AccessToken,token:o.Token}),a.label=4;case 4:return l(e,n),t?[2,O(e)]:[2,null];case 5:return s(e),[7];case 6:return[2]}})})}Object(r.orchestrator)(i,function(){return v.__awaiter(void 0,void 0,void 0,function(){var e;return v.__generator(this,function(t){switch(t.label){case 0:if(!p.getWacInfoQueue.length)return[2];if(p.activeGetWacInfoOperations.length>=2)return[2];e=p.getWacInfoQueue[0],u(e),c(),t.label=1;case 1:return t.trys.push([1,,3,4]),[4,w(e,!1)];case 2:return t.sent(),[3,4];case 3:return s(e),i(),[7];case 4:return[2]}})})});var _=n(18),y=n(92),I=n(5528),k=n(2469),g="originalsrc",P="shash",U="data-auth",L="&reserved=0",W="SP_LINK_CLICK_EVENT_LISTENER";function D(e){e.addEventListener("click",E),e[W]=E,e.addEventListener("mouseup",N)}function T(e,t,n){o(t);var r=function(e){!function(e,t){var n=null;if(!(e.altKey||e.ctrlKey||e.metaKey||e.shiftKey)){var r=e.currentTarget,o=h(Object(m.e)("doc-SxS-jsApi-ODB-Links")&&R(r)?r.getAttribute(g):r.href),a=o.docLinkPreviewInfo,i=o.reason;if(a)return Object(k.a)(function(){return Promise.resolve(a.wacUrlInfo)},t),e.preventDefault(),void A(null);n=i}A(n||(e.altKey?"AltKey":e.ctrlKey?"CtrlKey":e.metaKey?"MetaKey":e.shiftKey?"ShiftKey":"Unknown")),E(e)}(e,n)};e.addEventListener("click",r),e[W]=r,e.addEventListener("mouseup",N)}function N(e){1===e.button&&A("MouseMiddleButton")}function A(e){Object(_.o)("SharePointLinkClick",{newTabReason:e})}Object(r.orchestrator)(k.b,function(e){var t=e.element,n=e.itemId;if("a"===t.tagName.toLowerCase()){var r=t;if(R(r)){var o=t.getAttribute(g);Object(I.a)(o)&&(Object(I.b)(o)?Object(m.e)("doc-sharepoint-serviceGeneratedLinkTelemetry")&&D(t):Object(m.e)("doc-SxS-jsApi-ODB-Links")&&"Verified"===t.getAttribute(U)?T(t,o,n):Object(m.e)("doc-sharepoint-serviceGeneratedLinkTelemetry")&&D(t),B())}else{o=r.href;Object(I.a)(o)&&(Object(I.b)(o)?Object(m.e)("doc-sharepoint-serviceGeneratedLinkTelemetry")&&D(t):Object(m.e)("doc-SxS-jsApi-ODB-Links")?T(t,o,n):Object(m.e)("doc-sharepoint-serviceGeneratedLinkTelemetry")&&D(t),B())}}});var G=!1;function B(){G||(G=!0,Object(_.o)("SharePointLinkFound"))}function R(e){return e.hasAttribute(g)&&e.hasAttribute(P)&&e.hasAttribute(U)}function E(e){var t,n=Date.now(),r=new _.a("ServiceGeneratedLinkClickHandler"),o="CT="+n+"&OR=OWA-"+(e?e.ctrlKey||1===e.button?"NTB":e.shiftKey?"NW":"NT":"NT")+"&CID="+Object(y.a)(),a=e.currentTarget;if(R(a)){var i=a.href,c=i.indexOf(L);if(-1===c)return;var u=encodeURIComponent(btoa(o));t=i.substr(0,c)+"&xdata="+u+L}else{var s=a.href.indexOf("?")>=0?"&":"?";t=a.href+s+o}r.end(),window.open(t),e.preventDefault()}function K(e){var t=p.docLinkPreviewInfoMap.get(e),n=!!t;return(!t||t.time+b<=Date.now())&&o(e),n}Object(r.orchestrator)(k.c,function(e){var t=e.elements;t&&t.forEach(function(e){var t=e[W];t&&(e.removeEventListener("click",t),e[W]=null),e.removeEventListener("mouseup",N)})}),Object(r.orchestrator)(o,function(e){var t=e.url;p.getWacInfoQueue.some(function(e){return e===t})||p.activeGetWacInfoOperations.some(function(e){return e===t})||p.suppressedUrls.some(function(e){return e===t})||O(t)||(a(t),i())}),n.d(t,"tryProcessSharePointLink",function(){return k.b}),n.d(t,"tryUndoProcessSharePointLink",function(){return k.c}),n.d(t,"docLinkHadPreviewInfo",function(){return K}),n.d(t,"forceGetWacInfoOperation",function(){return w}),n.d(t,"getValidDocLinkPreviewInfo",function(){return O})},3933:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=function(e){return r.__assign({__type:"FetchDataProviderResourceRequest:#Exchange"},e)}},4254:function(e,t,n){"use strict";n.d(t,"a",function(){return s});var r=n(0),o=n(4255),a=n.n(o),i=n(3933),c=n.n(i),u=n(11);function s(e,t,n){return r.__awaiter(this,void 0,void 0,function(){var o,i,s,f,l,d,p,v,b,O;return r.__generator(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),o=btoa(t),i="u!"+o.replace(/^\=+|\=+$/g,"").replace("/","_").replace("+","-"),s=new RegExp(/.+?\:\/\/.+?(\/)/g).exec(t)[0],f=s+"_api/v2.0/shares/"+i+"/root?select=openWith/wac,officeBundle,@content.downloadUrl,name,size,currentUserRole&action="+(n?"Open":"View"),l=c()({ProviderType:e,Url:f}),d=(new Date).getTime(),[4,a()(l)];case 1:if(200===(p=r.sent()).Status&&p.Body)return v=(new Date).getTime(),(b=JSON.parse(p.Body)).fetchStartTime=d,b.responseStartTime=v,b.openWith.wac.fileGetUrl=b["@content.downloadUrl"],!n&&b.currentUserRole&&(b.currentUserRole.readOnly=!0),[2,b];throw new Error("Result status is: "+p.Status+" or empty response body.");case 2:return O=r.sent(),u.d.warn("Something went wrong while calling fetchDataProviderResourceOperation: "+O),[3,3];case 3:return[2,null]}})})}},4255:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(56),o=n(3933);t.default=function(e,t){return void 0===e||e.__type||(e=o.default(e)),r.makeServiceRequest("FetchDataProviderResource",e,t)}},4325:function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r=n(4369),o=n.n(r);function a(e,t,n,r,a){return void 0===n&&(n=!1),void 0===r&&(r=!1),o()({request:{Url:e,IsEdit:r,ProviderType:t,ShouldGrantAccess:n}},a)}},4369:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(56),o=n(4370);t.default=function(e,t){return void 0===e.request||e.request.__type||(e.request=o.default(e.request)),r.makeServiceRequest("GetWacInfo",e,t)}},4370:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=function(e){return r.__assign({__type:"GetWacInfoRequest:#Exchange"},e)}},5528:function(e,t,n){"use strict";var r=n(18),o=n(1330),a=n(6),i=n(11),c=n(171),u=["https://microsoft.sharepoint.com","https://microsoft-my.sharepoint.com","https://microsoft.sharepoint-df.com","https://microsoft-my.sharepoint-df.com"];function s(e){if(!e)return Object(r.o)("isSharePointLinkCalledWithoutUrl"),!1;if("object"==typeof e){if(!(e instanceof String))return Object(r.o)("isSharePointLinkCalledWithNonNullNonStringObject",null,{cosmosOnlyData:JSON.stringify({objectProperties:Object.getOwnPropertyNames(e)})}),!1;e=e.toString(),Object(r.o)("isSharePointLinkCalledWithNonNullStringObject")}var t=Object(o.a)();return t?!!f(e,t.SPO_MySiteHostUrl)||(!!f(e,t.SPO_RootSiteUrl)||!!Object(a.e)("doc-SharePoint-dogfoodUser")&&u.some(function(t){return f(e,t)})):(i.d.info("isSharePointLink:bposNavBarData is null"),!1)}function f(e,t){return Object(c.parse)(e).hostname===Object(c.parse)(t).hostname&&e!==t}function l(e){return!!e&&(e.indexOf("?at=")>0||e.indexOf("&at=")>0)}n.d(t,"a",function(){return s}),n.d(t,"b",function(){return l})},847:function(e,t,n){"use strict";var r=n(2),o=Object(r.createStore)("bposStore",{bposNavBarData:null})();t.a=o}},0,[514,105,24,116]]);
//# sourceMappingURL=owa.SharePointLink.js.map
self.scriptsLoaded['owa.SharePointLink.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.SharePointLink.js'] = (new Date()).getTime();