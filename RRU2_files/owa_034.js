self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.738.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[738],{13755:function(e,t,n){"use strict";n.r(t);var r=n(0),o=n(223),a=n(235),i=n(37),s=n(287),u=n(11),c=n(12);function d(e,t){return r.__awaiter(this,void 0,void 0,function(){var n,o;return r.__generator(this,function(r){return 1===(n=t.tableQuery).listViewType?(o={Id:e,mailboxInfo:Object(a.c)(n)},[2,Object(s.i)(o,"LoadNudgedItem")]):[2,l(e,t)]})})}function l(e,t){return r.__awaiter(this,void 0,void 0,function(){var n,d;return r.__generator(this,function(r){return n=t.tableQuery,d=Object(a.c)(n),[2,i.E.importAndExecute(Object(c.i)(n),e,Object(o.e)(n),n.requestShapeName,d.requestOptions).then(function(t){if("Success"==t.ResponseClass){var n=t.Conversations;if(n&&n.length>0&&n[0].ConversationId.Id===e){var r={Id:e,mailboxInfo:d};return Object(s.h)(r,"LoadNudgedConversation"),n[0]}}return null}).catch(function(e){return u.d.warn("loadNudgedConversation throws an exception"+e.message),null})]})})}var b=n(44),f=n(242),w="https://outlook.office.com/FocusedInboxB2";function O(){return r.__awaiter(this,void 0,void 0,function(){var e,t;return r.__generator(this,function(n){switch(n.label){case 0:return[4,v()];case 1:return e=n.sent(),t=new Headers,e&&(t.authorization="Bearer "+e),[2,t]}})})}function v(){return r.__awaiter(this,void 0,void 0,function(){return r.__generator(this,function(e){return Object(b.a)()?[2,null]:[2,Object(f.getAccessTokenforResource)(w)]})})}var I=n(92),g=n(65),h="FocusedInboxB2/api/v1/Nudges/GetNudges";function j(){return r.__awaiter(this,void 0,void 0,function(){var e,t;return r.__generator(this,function(n){switch(n.label){case 0:return[4,O()];case 1:return e=n.sent(),[4,Object(g.b)(h,Object(I.a)(),!0,e)];case 2:t=n.sent(),n.label=3;case 3:return n.trys.push([3,5,,6]),[4,t.json()];case 4:return[2,n.sent()];case 5:return n.sent(),[2,null];case 6:return[2]}})})}var m=n(17),p=n(27);function y(e){switch(e){case"Received":return 0;case"Sent":return 1;default:return u.d.warn("No nudge reason returned in GetNudge server response"),0}}var _=n(6),N=n(747),C=n(1225),K=n(6117);function S(e){if(!Object(_.e)("tri-nudge")||Object(K.a)(16))return!1;if(e!==Object(p.a)("inbox")&&e!==Object(p.a)("sentitems"))return!1;var t=Object(c.C)();if("All"!=Object(c.I)(t))return!1;var n=Object(c.m)(t);if(0!=n&&-1!=n)return!1;var r=Object(c.q)(t.id);if(0!=r&&1!=r)return!1;var o=Object(N.a)(e),a={sortColumn:1,sortDirection:C.DESCENDING_SORT_DIR};return o.sortColumn==a.sortColumn&&o.sortDirection==a.sortDirection}var R=n(841),V=n(1940),x=n(318);function A(e,t){var n=t.rowKeys.indexOf(e);if(n>=0&&!c.b.getIsPinned(e,t)){var r=Object(V.a)(c.b.getLastDeliveryOrRenewTimeStamp(e,t),c.b.getLastDeliveryTimeStamp(e,t),t,n+1,!0);-1==r?Object(R.a)([e],t):x.a.updateRowPosition(--r,e,t)}}var F=n(3),P=n(976),k=n(256),B=n(568),D=n(160),U=!1,E=Object(F.e)(P.a,"clone_onSelectFolderComplete",function(e){return r.__awaiter(void 0,void 0,void 0,function(){var t,n,o,a,i,s;return r.__generator(this,function(u){switch(u.label){case 0:return U||!S(e.selectedFolderId)?[2]:(t=Object(c.C)()).tableQuery.folderId!=e.selectedFolderId?[2]:(U=!0,[4,j()]);case 1:if(n=u.sent(),o=[],!n||!n.Nudges)return[3,5];a=n.Nudges,i=0,u.label=2;case 2:return i<a.length?[4,M(a[i],t)]:[3,5];case 3:(s=u.sent())&&o.push(s),u.label=4;case 4:return i++,[3,2];case 5:return o.push.apply(o,r.__spread(function(e){var t=Object(m.a)("testNudge");if(0==decodeURIComponent(t||"").trim().length)return[];if(e.rowKeys.length>0){var n=e.tableQuery.folderId===Object(p.a)("sentitems")?1:0,r={rowKey:e.rowKeys[0],itemId:c.b.getItemIds(e.rowKeys[0],e)[0],conversationId:c.b.getConversationId(e.rowKeys[0],e),tableViewId:e.id,reason:n,daysAgo:5};return e.rowKeys.length>10&&1===Math.floor(2*Math.random())?[r,{rowKey:e.rowKeys[10],itemId:c.b.getItemIds(e.rowKeys[10],e)[0],conversationId:c.b.getConversationId(e.rowKeys[10],e),tableViewId:e.id,reason:n,daysAgo:3}]:[r]}return[]}(t))),Object(B.d)().nudgedRows.forEach(function(e){o.some(function(t){return t.rowKey===e.rowKey&&t.tableViewId===e.tableViewId})||A(e.rowKey,t)}),o.forEach(function(e){return function(e,t){if(!c.b.getIsPinned(e,t)){var n=Object(k.f)(t,0);x.a.updateRowPosition(n,e,t)}}(e.rowKey,t)}),Object(B.g)(o),U=!1,[2]}})})});function M(e,t){return r.__awaiter(this,void 0,void 0,function(){var n,o,i,l,b,f,w,O;return r.__generator(this,function(r){switch(r.label){case 0:return r.trys.push([0,4,,5]),e.FolderId.Id!=t.tableQuery.folderId?[2,null]:(n=e.ItemId.Id,o=e.ConversationId.Id,i=0===t.tableQuery.listViewType?o:n,l=void 0,0!==(b=Object(c.B)([i],t)).length?[3,2]:[4,d(i,t)]);case 1:return(f=r.sent())?(l=f.InstanceKey,t.rowKeys.indexOf(l)<0&&(w=Object(k.f)(t,0),x.a.addRow(w,f,t)),[3,3]):(u.d.warn("Unable to load nudged row for list view type:"+t.tableQuery.listViewType),[2,null]);case 2:l=b[0],function(e,t){if(1===e.listViewType){var n=Object(D.b)().items.get(t);n&&n.NormalizedBody||Object(s.i)({Id:t,mailboxInfo:Object(a.c)(e)},"LoadNudgedItem")}else Object(D.b)().conversations.get(t)||Object(s.h)({Id:t,mailboxInfo:Object(a.c)(e)},"LoadNudgedConversation")}(t.tableQuery,i),r.label=3;case 3:return[2,{rowKey:l,itemId:n,conversationId:o,tableViewId:t.id,reason:y(e.NudgeReason.Reason),daysAgo:e.NudgeReason.EmailAgeInDays}];case 4:return O=r.sent(),u.d.warn("processNudgeResponse throws an exception"+O.message),[2,null];case 5:return[2]}})})}var Q=n(207),T="FocusedInboxB2/api/v1/Nudges/UpdateNudge";function L(e,t){return r.__awaiter(this,void 0,void 0,function(){var n,o,a;return r.__generator(this,function(r){switch(r.label){case 0:return[4,O()];case 1:return n=r.sent(),o={ItemId:{Id:e},NudgeAction:t},[4,Object(g.d)(T,o,Object(I.a)(),!1,n)];case 2:a=r.sent();try{Object(Q.a)(a.status)||u.d.warn("updateNudgesOperation return http status "+a.status)}catch(e){return u.d.info("updateNudgesOperation return error "+e.message),[2,null]}return[2]}})})}var q=n(873),G=n(1688),z=n(1687),$=n(2723),H=n(2724),J=Object(F.e)(H.b,"clone_onNudgeInfoBarClicked",function(e){L(e.itemId,e.response===H.a.MarkComplete?"MarkedComplete":"Dismissed"),Object(B.h)(e.rowKey),A(e.rowKey,Object(c.C)())}),W=Object(F.e)(q.a,"clone_deleteItemsStoreUpdate",function(e){e.itemContexts.map(function(e){return e.itemId}).forEach(function(e){var t=Object(B.b)(e);t&&Object(B.h)(t)})}),X=Object(F.e)(R.a,"clone_removeRowsFromListViewStore",function(e){te(e.rowKeys,e.tableView.id)}),Y=Object(F.e)(z.a,"clone_markItemsAsPinnedStoreUpdate",function(e){ne(e.rowKeys,e.tableViewId,e.shouldMarkAsPinned),e.shouldMarkAsPinned&&te(e.rowKeys,e.tableViewId)}),Z=Object(F.e)(G.a,"clone_markConversationsAsPinnedStoreUpdate",function(e){ne(e.rowKeys,e.tableViewId,e.shouldMarkAsPinned),e.shouldMarkAsPinned&&te(e.rowKeys,e.tableViewId)}),ee=Object(F.e)($.a,"clone_onSendMessageSucceeded",function(e){if(1===e.operation||2===e.operation||3===e.operation){var t=Object(B.b)(e.referenceItemId.Id);t&&Object(B.h)(t)}});function te(e,t){e.forEach(function(e){Object(B.e)(e,t)&&Object(B.h)(e)})}function ne(e,t,n){e.forEach(function(e){var r=Object(B.d)().nudgedRows.filter(function(n){return n.rowKey===e&&n.tableViewId==t});1==r.length&&L(r[0].itemId,n?"Pinned":"Unpinned")})}n.d(t,"getNudgesOrchestrator",function(){return E}),n.d(t,"removeNudgeOnInfoBarClickedOrchestrator",function(){return J}),n.d(t,"removeNudgeOnItemDeleteStoreUpdateOrchestrator",function(){return W}),n.d(t,"removeNudgeOnRowsDeleteStoreUpdateOrchestrator",function(){return X}),n.d(t,"removeNudgeOnItemsPinnedStoreUpdateOrchestrator",function(){return Y}),n.d(t,"removeNudgeOnConversationsPinnedStoreUpdateOrchestrator",function(){return Z}),n.d(t,"removeNudgeOnReplyOrReplyAllOrForwardOrchestrator",function(){return ee})},6117:function(e,t,n){"use strict";n.d(t,"a",function(){return a}),n.d(t,"b",function(){return i});var r=n(25),o=n(8);function a(e){return!!(e&Object(r.f)().ViewStateConfiguration.FocusedInboxBitFlags)}var i=Object(o.action)("setBit")(function(e,t){a(t)!==e&&(e?Object(r.f)().ViewStateConfiguration.FocusedInboxBitFlags|=t:Object(r.f)().ViewStateConfiguration.FocusedInboxBitFlags&=~t)})}},0,[5,15,40,85,344,6,7,9,10,125,2,3,4,322,323,8,23,328,571,399,573,404,0,1,526,178,12,47,121,514,105,525,174,557,335,24,116,221,291,312,321,495,642]]);
//# sourceMappingURL=owa.738.js.map
self.scriptsLoaded['owa.738.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.738.js'] = (new Date()).getTime();