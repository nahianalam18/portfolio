self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.InlineImages.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[283],{11740:function(e){e.exports={d:"fhb",g:"ghb",e:"hhb",f:"ihb",b:"jhb",c:"khb",a:"lhb"}},13858:function(e,t,i){"use strict";i.r(t);var n=i(8),s=i(0),o=i(11740),a=i(4),r=i(1),l=i(54),d=i(19),h=i(1221),m=i(49),g=i(3849),c="data-imgsize",p="small",u="medium",I="bestfit",y="original",f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.createContextMenuItems=function(){var e=t.props.imageElement.getAttribute(c);e||(e=I);var i={items:[{name:Object(a.a)(o.d),key:"bestfit",onClick:function(){t.onSetSizeBestFit()},isChecked:e==I,canCheck:!0},{name:Object(a.a)(o.g),key:"small",onClick:function(){t.onSetSizeSmall()},isChecked:e==p,canCheck:!0},{name:Object(a.a)(o.e),key:"medium",onClick:function(){t.onSetSizeMedium()},isChecked:e==u,canCheck:!0},{name:Object(a.a)(o.f),key:"original",onClick:function(){t.onSetSizeOriginal()},isChecked:e==y,canCheck:!0}]};return[{name:Object(a.a)(o.b),key:"resize",subMenuProps:i},{name:Object(a.a)(o.c),key:"remove",onClick:function(){t.onRemoveImage()}},{name:Object(a.a)(o.a),key:"addAltText",onClick:function(){g.f.import().then(function(e){t.props.imageElement&&e(t.props.imageElement,function(e){t.props.imageElement.alt=e})})}}]},t.onDismissContextMenu=function(e){S(),t.props.afterDismissContextMenu()},t}return s.__extends(t,e),t.prototype.render=function(){return r.createElement(h.a,{shouldFocusOnMount:!0,directionalHint:m.a.bottomRightEdge,target:this.props.anchorPoint,onDismiss:this.onDismissContextMenu,items:this.createContextMenuItems()})},t.prototype.onSetSizeSmall=function(){this.removeImageWidthHeightAttributes(),this.props.imageElement.style.width=this.props.imageElement.naturalWidth/4+"px",this.props.imageElement.style.height="",this.props.imageElement.style.maxWidth="",this.props.imageElement.setAttribute(c,p),this.onImageChanged()},t.prototype.onSetSizeMedium=function(){this.removeImageWidthHeightAttributes(),this.props.imageElement.style.width=this.props.imageElement.naturalWidth/2+"px",this.props.imageElement.style.maxWidth="",this.props.imageElement.style.height="",this.props.imageElement.setAttribute(c,u),this.onImageChanged()},t.prototype.onSetSizeBestFit=function(){this.removeImageWidthHeightAttributes(),this.props.imageElement.style.width="",this.props.imageElement.style.height="",this.props.imageElement.style.maxWidth="100%",this.props.imageElement.setAttribute(c,I),this.onImageChanged()},t.prototype.onSetSizeOriginal=function(){this.removeImageWidthHeightAttributes(),this.props.imageElement.style.width=this.props.imageElement.naturalWidth+"px",this.props.imageElement.style.height="",this.props.imageElement.style.maxWidth="",this.props.imageElement.setAttribute(c,y),this.onImageChanged()},t.prototype.removeImageWidthHeightAttributes=function(){this.props.imageElement.removeAttribute("width"),this.props.imageElement.removeAttribute("height")},t.prototype.onRemoveImage=function(){this.props.imageElement.parentNode.removeChild(this.props.imageElement),this.onImageChanged()},t.prototype.onImageChanged=function(){this.props.onImageChanged&&this.props.onImageChanged()},t=s.__decorate([d.observer],t)}(r.Component),v=null;function S(){v&&(l.unmountComponentAtNode(v),v.parentNode.removeChild(v),v=null)}var E,b=i(86),z=i(11),B=function(){function e(){var e=this;this.onMouseDownOnResizeHandle=function(t){e.imageSizeAtDragStart={width:e.selectedImage.width,height:e.selectedImage.height},e.dragHandlePositionAtDragStart={left:t.pageX,top:t.pageY},e.divBeingDragged=t.target,e.selectedImage.setAttribute(c,"custom")},this.onMouseMove=function(t){null!=e.divBeingDragged&&(e.selectedImage.style.maxWidth="",e.updateImageWidthAndHeightDuringDrag(t),e.updateSelectionBorderAndResizeHandlePositions(e.getElementPosition(e.selectedImage)))},this.onMouseUp=function(t){null!=e.divBeingDragged&&(e.divBeingDragged=null,e.onImageChanged&&e.onImageChanged())},this.bindEvents()}return e.prototype.dispose=function(){var e=this;this.selectedImageBorder&&(this.selectedImageBorder.parentElement&&this.selectedImageBorder.parentElement.removeChild(this.selectedImageBorder),this.selectedImageBorder=null),this.resizeHandles&&(this.resizeHandles.forEach(function(t,i){t.removeEventListener("mousedown",e.onMouseDownOnResizeHandle),t.parentElement.removeChild(t),t=null}),this.resizeHandles=null),this.unbindEvents(),this.selectedImage=null,this.imageSizeAtDragStart=null,this.dragHandlePositionAtDragStart=null,this.divBeingDragged=null,this.composeBodyWrapper=null},e.prototype.deselectImage=function(e){this.divBeingDragged||(this.selectedImage=null,this.selectedImageBorder&&(this.selectedImageBorder.style.display="none"),this.resizeHandles&&this.resizeHandles.forEach(function(e,t){e.style.display="none"})),e.imageSelected=null!=this.selectedImage,e.imageSelected||(this.onImageChanged=null)},e.prototype.selectImage=function(e,t,i,n){this.onImageChanged=n;var s=this.selectedImage==e;this.selectedImage&&this.deselectImage(i),s||(this.selectedImage=e,this.setComposeBodyWrapperDiv(t),e.parentElement&&"a"===e.parentElement.tagName.toLowerCase()||this.addSelectionBorderAndResizeHandles()),i.imageSelected=null!=this.selectedImage},e.prototype.deleteImage=function(e){var t=this.selectedImage;this.deselectImage(e),t&&t.parentNode&&t.parentNode.removeChild(t)},e.prototype.getSelectedImage=function(){return this.selectedImage},e.prototype.updateBorderOnScroll=function(){null!=this.selectedImage&&this.updateSelectionBorderAndResizeHandlePositions(this.getElementPosition(this.selectedImage))},e.prototype.setComposeBodyWrapperDiv=function(e){this.composeBodyWrapper=e},e.prototype.addSelectionBorderAndResizeHandles=function(){this.selectedImageBorder||this.createSelectedImageBorder(),this.resizeHandles||this.createResizeHandles(),this.updateSelectionBorderAndResizeHandlePositions(this.getElementPosition(this.selectedImage)),this.resizeHandles.forEach(function(e,t){e.style.display="block"}),this.selectedImageBorder.style.display="block"},e.prototype.updateSelectionBorderAndResizeHandlePositions=function(e){this.resizeHandles&&this.selectedImageBorder?(this.resizeHandles[0].style.left=e.left-3+"px",this.resizeHandles[0].style.top=e.top-3+"px",this.resizeHandles[1].style.left=e.left+this.selectedImage.clientWidth-3+"px",this.resizeHandles[1].style.top=e.top-3+"px",this.resizeHandles[2].style.left=e.left+this.selectedImage.clientWidth-3+"px",this.resizeHandles[2].style.top=e.top+this.selectedImage.clientHeight-3+"px",this.resizeHandles[3].style.left=e.left-3+"px",this.resizeHandles[3].style.top=e.top+this.selectedImage.clientHeight-3+"px",this.selectedImageBorder.style.left=e.left+"px",this.selectedImageBorder.style.top=e.top+"px",this.selectedImageBorder.style.width=this.selectedImage.width-1+"px",this.selectedImageBorder.style.height=this.selectedImage.height-1+"px"):z.d.info("updateSelectionBorderAndResizeHandlePositions: failed to execute method")},e.prototype.createSelectedImageBorder=function(){this.selectedImageBorder=document.createElement("div"),this.selectedImageBorder.id="selectedImageBorder",this.selectedImageBorder.style.display="none",this.selectedImageBorder.style.borderWidth="1px",this.selectedImageBorder.style.borderStyle="solid",this.selectedImageBorder.style.borderColor=Object(b.g)().themePrimary,this.selectedImageBorder.style.position="absolute",this.selectedImageBorder.style.pointerEvents="none",this.composeBodyWrapper.appendChild(this.selectedImageBorder)},e.prototype.createResizeHandles=function(){this.resizeHandles=[];for(var e=["nw","ne","se","sw"],t=0;t<4;t++){var i=document.createElement("div");i.setAttribute("data-position",e[t]),i.style.display="none",i.style.width="6px",i.style.height="6px",i.style.position="absolute",i.style.backgroundColor=Object(b.g)().themePrimary,i.style.cursor=e[t]+"-resize",i.addEventListener("mousedown",this.onMouseDownOnResizeHandle),this.composeBodyWrapper.appendChild(i),this.resizeHandles.push(i)}},e.prototype.bindEvents=function(){document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp)},e.prototype.unbindEvents=function(){document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp)},e.prototype.updateImageWidthAndHeightDuringDrag=function(e){var t;switch(this.divBeingDragged.getAttribute("data-position")){case"nw":t={x:-1,y:-1};break;case"ne":t={x:1,y:-1};break;case"se":t={x:1,y:1};break;case"sw":t={x:-1,y:1};break;default:t={x:1,y:1}}var i=e.pageX-this.dragHandlePositionAtDragStart.left,n=e.pageY-this.dragHandlePositionAtDragStart.top,s=i*t.x+n*t.y,o=(this.imageSizeAtDragStart.width+s)/this.imageSizeAtDragStart.width,a=Math.min(50,this.selectedImage.naturalWidth),r=Math.min(50,this.selectedImage.naturalHeight);(this.imageSizeAtDragStart.width*o<a||this.imageSizeAtDragStart.height*o<r)&&(o=Math.max(a/this.imageSizeAtDragStart.width,r/this.imageSizeAtDragStart.height));var l=this.imageSizeAtDragStart.width*o,d=this.imageSizeAtDragStart.height*o;this.selectedImage.style.width=l+"px",this.selectedImage.style.height=d+"px",this.selectedImage.setAttribute("width",l+""),this.selectedImage.setAttribute("height",d+"")},e.prototype.getElementPosition=function(e){if(!this.selectedImageBorder)throw new Error("getElementPosition called without defined selectedImageBorder");var t=e.getBoundingClientRect(),i=this.selectedImageBorder.parentElement.getBoundingClientRect();return{top:t.top-i.top,left:t.left-i.left}},e}();function C(e){E&&E.deselectImage(e)}function x(){var e=null;return E&&(e=E.getSelectedImage()),e}var w=Object(n.action)("showInlineImageContextMenu")(function(e,t,i,n,s,o){C(i),function(e,t,i,n,s){v&&S(),(v=document.createElement("div")).id="inlineImageContentMenu",(s||document.body).appendChild(v),l.render(r.createElement(f,{anchorPoint:t,imageElement:e,afterDismissContextMenu:i,onImageChanged:n}),v)}(e,t,n,s,o)}),H=function(){function e(){var e=this;this.onImageChanged=function(){e.editor&&e.editor.addUndoSnapshot()},this.onContextMenu=function(t){t.stopPropagation(),t.preventDefault(),w(t.target,{x:t.clientX,y:t.clientY},e.imageSelectionState,function(){e.editor&&e.editor.focus()},e.onImageChanged,e.contextMenuParentDiv)},this.boundInlineImages=[],this.imageSelectionInitialized=!1,this.imageSelectionState={imageSelected:!1}}return e.prototype.getName=function(){return"InlineImageResize"},e.prototype.initialize=function(e){this.editor=e,this.editor.getDocument().execCommand("enableObjectResizing",!1,"false")},e.prototype.dispose=function(){this.editor=null,this.cleanupBoundInlineImages(),this.composeBodyWrapper=null,this.imageSelectionInitialized&&(E&&(E.dispose(),E=null),this.imageSelectionInitialized=!1)},e.prototype.onPluginEvent=function(e){if(14===e.eventType)E&&E.updateBorderOnScroll();else if(5===e.eventType){var t=e.rawEvent.target;null!==t&&"IMG"==t.nodeName?(this.bindEventsForNewInlineImage(t),n=t,s=this.composeBodyWrapper,o=this.imageSelectionState,a=this.onImageChanged,E||(E=new B),E.selectImage(n,s,o,a)):this.deselectImageIfNecessary()}else if(0===e.eventType){var i=e.rawEvent;46===i.which||8===i.which?this.removeSelectedImage()&&(e.rawEvent.stopPropagation(),e.rawEvent.preventDefault()):this.deselectImageIfNecessary()}var n,s,o,a},e.prototype.setComposeBodyWrapperDiv=function(e){this.composeBodyWrapper=e},e.prototype.setContextMenuParentDiv=function(e){this.contextMenuParentDiv=e},e.prototype.bindEventsForNewInlineImage=function(e){this.boundInlineImages.includes(e)||(this.boundInlineImages.push(e),e.addEventListener("contextmenu",this.onContextMenu)),this.imageSelectionInitialized=!0},e.prototype.cleanupBoundInlineImages=function(){var e=this;this.boundInlineImages.forEach(function(t){t.removeEventListener("contextmenu",e.onContextMenu)}),this.boundInlineImages=null},e.prototype.deselectImageIfNecessary=function(){this.imageSelectionInitialized&&this.imageSelectionState.imageSelected&&C(this.imageSelectionState)},e.prototype.removeSelectedImage=function(){return!(!this.imageSelectionInitialized||!this.imageSelectionState.imageSelected)&&(e=this.imageSelectionState,E&&E.deleteImage(e),!0);var e},e}();i.d(t,"InlineImageResizePlugin",function(){return H}),i.d(t,"getSelectedImage",function(){return x})}},0,[4,10,15,17,273,50,215]]);
//# sourceMappingURL=owa.InlineImages.js.map
self.scriptsLoaded['owa.InlineImages.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.InlineImages.js'] = (new Date()).getTime();